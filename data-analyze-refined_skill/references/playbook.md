# Data Analyze Playbook

简明 SOP，供加载到上下文时使用。

## 1) 先判数据
- 预处理：列名去空白，别名映射（申报企业/厂家 → 品牌名称；地市/地区/地区名称 → 城市；目录名称 → 产品大类；产品名称/注册证名称 → 注册证产品名称），关键数值列尝试转数值。
- 核心维度优先：品牌/申报企业/厂家 → 医院/渠道/客户 → 城市/区域 → 其他非唯一度低的分类列。
- 核心指标优先：`--value-column` > 协议采购量/采购需求量/第三年采购需求量/数量/总量/合同量/GMV/金额/采购量 > 首个数值列。
- 检查可用层级：注册证产品、目录/大类、城市、医院是否有有效唯一值>1，用于后续交叉。
- 缺时间列则跳过趋势；缺价格列则跳过价量；数值列 <2 或最高相关 <0.3 则不出相关性。

## 2) 分析框架
- 字段画像/数值统计：仅参考，不必入汇总表。
- 分类分布：唯一值 2~50 且非 90% 全唯一的列做 TopN。
- 份额与集中度：核心维度、城市、目录、大类的份额；Top1/3/5 占比、覆盖 80/90 所需实体数、离群。
- 跨层结构：品牌×城市（长表、城市Top3+CR3）、品牌×注册证产品（品牌内产品份额）、城市×注册证产品。
- 产品粒度：注册证产品分布、品牌内产品Top；必要时目录/大类与品牌交叉。
- 覆盖与医院：覆盖医院数/单院均量，医院TOP；目标品牌医院白院（低份额×高容量）。
- 机会：目标品牌城市白区（城市总量×目标品牌份额），医院白院；如有时间/价格/结构字段再补价格-量、结构占比、时间趋势。

## 3) 图表策略（PNG+SVG）
- 默认 charts-mode=auto：存在可视价值才出图；on 强制；off 不出。
- 必备图：核心维度份额 Top15、城市 Top15、目录 Top12、产品大类 Top10、覆盖（医院数+单院均量）。
- 选配图：机会城市/白区散点、结构/价格/趋势等在字段存在且分布有效时输出。

## 4) 输出规范
- 输出根：数据同级 `outputs/`（可用 --output-dir 自定义）。
- CSV：核心维度/城市/目录/大类/覆盖、城市品牌分布、城市Top3、城市白区（目标品牌）、产品分布、品牌产品分布、城市产品分布、品牌产品Top、医院TOP、医院白院等；字段概览/数值统计仅参考。
- Excel：`outputs/excel/数据分析汇总.xlsx`，目录+返回目录，包含上述业务表，默认不放字段概览/数值统计。
- 图表：`outputs/figures/png|svg`（核心份额/城市/目录/大类/覆盖等）。
- 报告：`outputs/reports/<数据名>_分析报告.docx`（市场视角）；`outputs/reports/洞察分析.json`；`outputs/html/market_analysis_infographic.html`（核心结论+图表）；`outputs/html/charts_gallery.html`（图表汇总）。

## 5) 报告写法（市场部）
- 核心结论：总量、CR3/CR5、龙头份额、主力目录/城市、覆盖（覆盖医院数/城市数/单院均量）。
- 产品/结构：注册证产品Top、品牌内主打产品/结构（有列时）。
- 机会：目标品牌城市白区、医院白院（低份额×高容量）；价格/时间/结构字段存在时补充对应洞察。
- 行动计划：头部清单、长尾/白区试点、产品/结构/价格打法、补充字段建议（时间/渠道/价格）。
